---
phase: 03.1-polish
plan: 01
subsystem: ui
tags: [game-ui, svg, tailwind, state-management]

# Dependency graph
requires:
  - phase: 03-game-loop
    provides: Base game components (GrandStaff, ScrollingNote, GameScreen, useGameSession)
provides:
  - Fixed grand staff display with proper clef positioning
  - Circular note shapes with appropriate spawn density
  - Real-time countdown timer display
affects: [03.1-02, game-ui]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - TIMER_TICK action for triggering periodic re-renders in useReducer

key-files:
  created: []
  modified:
    - src/components/game/GrandStaff.tsx
    - src/components/game/ScrollingNote.tsx
    - src/screens/GameScreen.tsx
    - src/hooks/useGameSession.ts
    - src/types/game.ts

key-decisions:
  - "Fixed spawn intervals (1500/1000/750ms) instead of dynamic formula for consistent note density"
  - "TIMER_TICK action pattern to force useMemo recalculation for timer display"
  - "stroke-red-500 class for timing line (Tailwind v4 compatible, high visibility)"

patterns-established:
  - "TIMER_TICK pattern: dispatch periodic actions to trigger computed value recalculation"

requirements-completed: [GAME-03, GAME-05]

# Metrics
duration: 4min
completed: 2026-03-01
---

# Phase 3.1 Plan 01: Visual & Timer Fixes Summary

**Fixed grand staff clef positioning, note shape/density, and real-time countdown timer display**

## Performance

- **Duration:** 4 min
- **Started:** 2026-03-01T05:47:29Z
- **Completed:** 2026-03-01T05:52:20Z
- **Tasks:** 3
- **Files modified:** 5

## Accomplishments

- Grand staff displays with proper minimum width and correctly positioned clefs (treble on G-line, bass on F-line)
- Timing line now visible using Tailwind v4 compatible stroke-red-500 class
- Notes render as perfect circles (w-5 h-5) instead of ovals
- Fixed spawn intervals ensure 3-4 notes visible at all scroll speeds
- Timer counts down in real-time during gameplay via TIMER_TICK action pattern

## Task Commits

Each task was committed atomically:

1. **Task 1: Fix grand staff display** - `29fe4c1` (fix)
2. **Task 2: Fix note shape and spawn density** - `86021c0` (fix)
3. **Task 3: Fix timer countdown display** - `dc62bb5` (fix)

## Files Created/Modified

- `src/components/game/GrandStaff.tsx` - Fixed clef Y positions, font size, min-width, timing line color
- `src/components/game/ScrollingNote.tsx` - Changed note from oval to circle (w-5 h-5)
- `src/screens/GameScreen.tsx` - Fixed spawn intervals (1500/1000/750ms per speed)
- `src/hooks/useGameSession.ts` - Added TIMER_TICK interval and currentTime state
- `src/types/game.ts` - Added TIMER_TICK action type and currentTime to GameState

## Decisions Made

1. **Fixed spawn intervals over dynamic formula** - The containerWidth-based formula produced inconsistent note density across screen sizes. Fixed intervals (slow=1500ms, medium=1000ms, fast=750ms) ensure consistent 3-4 visible notes regardless of viewport.

2. **TIMER_TICK action pattern** - The remainingMs useMemo wasn't recalculating because its deps (status, startTime, duration) don't change during gameplay. Added currentTime field that updates every second to trigger recalculation.

3. **Tailwind class for timing line** - Used `className="stroke-red-500"` instead of inline `stroke="hsl(var(--primary))"` for Tailwind v4 compatibility with oklch color format.

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- Visual fixes complete, ready for Plan 02 (Wait Mode implementation)
- Timer now updates correctly for user feedback
- Note density appropriate for gameplay

---
*Phase: 03.1-polish*
*Completed: 2026-03-01*

## Self-Check: PASSED

All 5 modified files exist on disk. All 3 task commits (29fe4c1, 86021c0, dc62bb5) verified in git log.
